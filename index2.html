–ö–æ–Ω–µ—á–Ω–æ, —è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ —Å —É—á–µ—Ç–æ–º —Ä–∞–Ω–µ–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π. –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏, –æ–±—ä—è—Å–Ω—è—é—â–∏–º–∏ –≤–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ ¬∑ –ö–æ–º–Ω–∞—Ç—ã</title>
    <style>
        /* –í–∞—à–∏ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
    </style>
</head>
<body>
<div id="app">
    <!-- –õ–æ–±–±–∏ —Å –∫–æ–º–Ω–∞—Ç–∞–º–∏ -->
    <div id="lobby">
        <h1>‚ö™ –í–´–ë–ï–†–ò–¢–ï –ö–û–ú–ù–ê–¢–£ ‚ö´</h1>
        <div class="rooms-grid" id="rooms-container">
            <!-- –∫–æ–º–Ω–∞—Ç—ã –ø–æ–¥–≥—Ä—É–∑—è—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        <div class="rules">
            <h2>–ü–†–ê–í–ò–õ–ê</h2>
            <p>‚ú¶ –ò–≥—Ä–∞ –¥–æ —Ç—Ä—ë—Ö –ø–æ–±–µ–¥ –≤ —Å–µ—Ä–∏–∏.<br>
               ‚ú¶ –ü–µ—Ä–≤—ã–π —Ö–æ–¥ –≤—Å–µ–≥–¥–∞ –∑–∞ –∫—Ä–µ—Å—Ç–∏–∫–∞–º–∏.<br>
               ‚ú¶ –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏–∏ –¥–æ—Å–∫–∞ –æ—á–∏—â–∞–µ—Ç—Å—è, —Å—á—ë—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.<br>
               ‚ú¶ –ö–æ–≥–¥–∞ –æ–¥–∏–Ω –∏–∑ –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞–±–∏—Ä–∞–µ—Ç 3 –ø–æ–±–µ–¥—ã, –º–∞—Ç—á –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.<br>
               ‚ú¶ –ß—Ç–æ–±—ã —Å—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞, –æ–±–∞ –¥–æ–ª–∂–Ω—ã –Ω–∞–∂–∞—Ç—å ¬´–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞¬ª.</p>
        </div>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
    <div id="game">
        <div class="game-header">
            <div class="room-info">
                <h2 id="game-room-title">–ö–æ–º–Ω–∞—Ç–∞</h2>
            </div>
            <button class="exit-btn" id="exit-game-btn">‚áΩ –í—ã–π—Ç–∏</button>
        </div>

        <div class="player-badge" id="player-badge">
            <span>—Ç—ã –∏–≥—Ä–∞–µ—à—å –∑–∞</span>
            <span class="symbol-icon" id="your-symbol">‚ùî</span>
        </div>

        <div class="turn-indicator" id="turn-status">–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</div>

        <div class="scores">
            <div class="score-item">X <span class="score-value" id="score-x">0</span></div>
            <div class="score-item">O <span class="score-value" id="score-o">0</span></div>
        </div>

        <div class="board" id="board"></div>

        <div class="rematch-area">
            <button id="rematch-btn" disabled>–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞ 0/2</button>
            <div id="rematch-status"></div>
        </div>
    </div>
    <div class="footer-note">‚ö™‚ö´ –ú–ò–ù–ò–ú–ê–õ–ò–ó–ú ‚Ä¢ –ë–ï–õ–´–ô ‚Ä¢ –°–ï–†–´–ô ‚Ä¢ –ß–Å–†–ù–´–ô</div>
</div>

<script type="module">
    // ========== FIREBASE –° –í–ê–®–ò–ú –ö–û–ù–§–ò–ì–û–ú ==========

    // –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, collection, query, getDocs } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDsiylf6dcAs8rstgLuO8ea6XHWruBKrJU",
        authDomain: "tic-tac-toe-rooms.firebaseapp.com",
        projectId: "tic-tac-toe-rooms",
        storageBucket: "tic-tac-toe-rooms.appspot.com",
        messagingSenderId: "831043796703",
        appId: "1:831043796703:web:aa22df01b2ba9fdef0b36a"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ========== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========

    const myId = localStorage.getItem('playerId') || crypto.randomUUID();
    localStorage.setItem('playerId', myId);

    let currentRoomId = null;
    let roomUnsubscribe = null;
    let mySymbol = null; // 'X' –∏–ª–∏ 'O'

    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const lobbyDiv = document.getElementById('lobby');
    const gameDiv = document.getElementById('game');
    const roomsContainer = document.getElementById('rooms-container');
    const gameRoomTitle = document.getElementById('game-room-title');
    const yourSymbolSpan = document.getElementById('your-symbol');
    const turnStatus = document.getElementById('turn-status');
    const scoreXSpan = document.getElementById('score-x');
    const scoreOSpan = document.getElementById('score-o');
    const boardDiv = document.getElementById('board');
    const rematchBtn = document.getElementById('rematch-btn');
    const rematchStatus = document.getElementById('rematch-status');
    const exitGameBtn = document.getElementById('exit-game-btn');

    // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï ==========

    function showLobby() {
        if (roomUnsubscribe) { roomUnsubscribe(); roomUnsubscribe = null; }
        currentRoomId = null;
        mySymbol = null;
        lobbyDiv.style.display = 'block';
        gameDiv.style.display = 'none';
        loadRooms();
    }

    function showGame(roomId) {
        lobbyDiv.style.display = 'none';
        gameDiv.style.display = 'block';
        gameRoomTitle.textContent = `–ö–æ–º–Ω–∞—Ç–∞ ${roomId}`;
    }

    // ========== –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –°–ï–°–°–ò–ò ==========

    async function restoreSession() {
        const roomsRef = collection(db, 'rooms');
        const snapshot = await getDocs(roomsRef);
        for (const docSnap of snapshot.docs) {
            const data = docSnap.data();
            if (data.player1Id === myId || data.player2Id === myId) {
                // –ù–∞—à–ª–∏ –∫–æ–º–Ω–∞—Ç—É, –≥–¥–µ –º—ã —É–∂–µ –µ—Å—Ç—å
                const roomId = docSnap.id;
                currentRoomId = roomId;

                // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                if (roomUnsubscribe) roomUnsubscribe();
                roomUnsubscribe = onSnapshot(doc(db, 'rooms', roomId), (docSnap) => {
                    if (!docSnap.exists()) return;
                    handleRoomUpdate(roomId, docSnap.data());
                });

                showGame(roomId);
                return true;
            }
        }
        return false; // —Å–µ—Å—Å–∏—è –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
    }

    // ========== –õ–û–ë–ë–ò: –ó–ê–ì–†–£–ó–ö–ê –ö–û–ú–ù–ê–¢ ==========

    async function ensureRoomsExist() {
        const roomIds = ['room1', 'room2', 'room3'];
        for (const id of roomIds) {
            const ref = doc(db, 'rooms', id);
            const snap = await getDoc(ref);
            if (!snap.exists()) {
                await setDoc(ref, {
                    player1Id: null,
                    player2Id: null,
                    player1Symbol: null,
                    player2Symbol: null,
                    game: {
                        board: Array(9).fill(null),
                        currentTurn: 'X',
                        winner: null,
                        scores: { X: 0, O: 0 },
                        status: 'waiting',
                        rematch: { player1: false, player2: false }
                    }
                });
            }
        }
    }

    async function loadRooms() {
        await ensureRoomsExist();
        const roomsQuery = query(collection(db, 'rooms'));
        onSnapshot(roomsQuery, (snapshot) => {
            const rooms = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderRooms(rooms);
        });
    }

    function renderRooms(rooms) {
        roomsContainer.innerHTML = '';
        rooms.forEach(room => {
            const count = (room.player1Id ? 1 : 0) + (room.player2Id ? 1 : 0);
            const card = document.createElement('div');
            card.className = `room-card ${count === 2 ? 'full' : ''}`;
            card.innerHTML = `
                <h3>üö™ ${room.id}</h3>
                <p>–ò–≥—Ä–æ–∫–æ–≤: ${count}/2</p>
                <button ${count === 2 ? 'disabled' : ''} data-room="${room.id}">–í–æ–π—Ç–∏</button>
            `;
            card.querySelector('button').addEventListener('click', () => joinRoom(room.id));
            roomsContainer.appendChild(card);
        });
    }

    // ========== –í–•–û–î –í –ö–û–ú–ù–ê–¢–£ ==========

    async function joinRoom(roomId) {
        // –ï—Å–ª–∏ —É–∂–µ –≤ –∫–æ–º–Ω–∞—Ç–µ, —Å–Ω–∞—á–∞–ª–∞ –≤—ã—Ö–æ–¥–∏–º
        if (currentRoomId) {
            if (currentRoomId === roomId) return; // —É–∂–µ –≤ —ç—Ç–æ–π –∫–æ–º–Ω–∞—Ç–µ
            else await leaveRoom();
        }

        const roomRef = doc(db, 'rooms', roomId);
        const roomSnap = await getDoc(roomRef);
        if (!roomSnap.exists()) return;

        const data = roomSnap.data();

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–∞ –ª–∏ –∫–æ–º–Ω–∞—Ç–∞
        if (data.player1Id && data.player2Id) {
            // –ù–æ –º–æ–∂–µ—Ç –±—ã—Ç—å, —ç—Ç–æ –º—ã —Å–∞–º–∏? –ü—Ä–æ–≤–µ—Ä–∏–º:
            if (data.player1Id === myId || data.player2Id === myId) {
                // –ú—ã —É–∂–µ –∑–¥–µ—Å—å, –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è
                // (—Ç–∞–∫–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å, –µ—Å–ª–∏ –º—ã —Å–ª—É—á–∞–π–Ω–æ –≤—ã–∑–≤–∞–ª–∏ joinRoom –ø–æ–≤—Ç–æ—Ä–Ω–æ)
                if (roomUnsubscribe) roomUnsubscribe();
                roomUnsubscribe = onSnapshot(roomRef, (docSnap) => {
                    if (!docSnap.exists()) return;
                    handleRoomUpdate(roomId, docSnap.data());
                });
                currentRoomId = roomId;
                showGame(roomId);
                return;
            } else {
                alert('–ö–æ–º–Ω–∞—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞');
                return;
            }
        }

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∑–∞ –∫–æ–≥–æ –≤–æ–π—Ç–∏
        const update = {};
        if (!data.player1Id) update.player1Id = myId;
        else if (!data.player2Id) update.player2Id = myId;
        else return; // –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–ª—É—á–∏—Ç—å—Å—è

        await updateDoc(roomRef, update);

        // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è
        if (roomUnsubscribe) roomUnsubscribe();
        roomUnsubscribe = onSnapshot(roomRef, (docSnap) => {
            if (!docSnap.exists()) return;
            handle 